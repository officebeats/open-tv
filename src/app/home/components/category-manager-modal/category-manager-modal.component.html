<div class="modal-header category-manager-header">
  <div class="header-left">
    <h4 class="modal-title m-0">Library Curator</h4>
    <p class="text-muted small m-0">Select and manage your channel groups</p>
  </div>
  <button
    type="button"
    class="btn-close btn-close-white"
    (click)="closeModal()"
    title="Close curator"
  ></button>
</div>

<div class="modal-body category-manager-body">
  <!-- Top Bar: Search & Global Sync -->
  <div class="top-actions-bar mb-3">
    <div class="d-flex align-items-center gap-3 w-100">
      <!-- Search Input -->
      <div class="search-wrapper flex-grow-1">
        <div class="input-group input-group-sm">
          <span class="input-group-text bg-dark border-secondary text-muted">
            <i class="fa fa-search"></i>
          </span>
          <input
            type="text"
            class="form-control compact-input"
            placeholder="Search regions or groups..."
            [(ngModel)]="searchQuery"
            (ngModelChange)="filterList()"
          />
        </div>
      </div>

      <!-- Quick Global Actions -->
      <div class="d-flex gap-2">
        <button class="btn btn-outline-danger btn-sm px-3" (click)="hideAll()" title="Archive All">
          Archive All
        </button>
        <button
          class="btn btn-outline-success btn-sm px-3"
          (click)="unhideAll()"
          title="Restore All"
        >
          Restore All
        </button>
      </div>
    </div>
  </div>

  <!-- Smart Action Bar (Visible when items selected) -->
  <div class="selection-action-bar" *ngIf="numSelected > 0" @fadeInOut>
    <div class="selection-info">
      <strong>{{ numSelected }}</strong> groups selected
    </div>
    <div class="action-buttons">
      <button class="action-btn-pill btn-archive" (click)="runSelectionAction('HIDE')">
        <i class="fa fa-archive"></i> Archive Selection
      </button>
      <button class="action-btn-pill btn-restore" (click)="runSelectionAction('SHOW')">
        <i class="fa fa-eye"></i> Restore Selection
      </button>
      <button
        class="action-btn-pill btn-focus"
        (click)="runSelectionAction('FOCUS')"
        title="Hide everything else except selected"
      >
        <i class="fa fa-crosshairs"></i> Focus Selection
      </button>
      <div class="vertical-divider"></div>
      <button class="btn-cancel" (click)="selectedPrefixes.clear(); processData()">Cancel</button>
    </div>
  </div>

  <!-- Main Grid Content -->
  <div class="families-grid-container customs-scroll">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <div class="spinner-border" role="status"></div>
      <div class="text-muted small">Loading groups...</div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && groupFamilies.length === 0" class="empty-state">
      <div class="empty-icon-circle">
        <i class="fa fa-folder-open-o"></i>
      </div>
      <h5>No groups found</h5>
      <p class="small text-muted">Try adjusting your search or sources.</p>
    </div>

    <div *ngIf="!loading && groupFamilies.length > 0" class="families-grid">
      <!-- Family Card -->
      <div
        *ngFor="let family of groupFamilies"
        class="curator-card"
        [class.status-all]="family.status === 'ALL'"
        [class.status-partial]="family.status === 'PARTIAL'"
        [class.status-none]="family.status === 'NONE'"
        [class.selected]="family.isSelected"
        [class.expanded]="family.expanded"
      >
        <!-- Card Content -->
        <div class="card-visual-wrapper">
          <!-- Multi-select Checkbox Trigger -->
          <div class="select-trigger" (click)="toggleFamilySelection(family, $event)">
            <div class="checkbox-box" [class.checked]="family.isSelected">
              <i class="fa fa-check" *ngIf="family.isSelected"></i>
            </div>
          </div>

          <!-- Header (Toggle Visibility or Expand) -->
          <div class="curator-header" (click)="toggleFamily(family, $event)">
            <div class="status-indicator"></div>
            <span class="family-name">{{ family.prefix }}</span>
            <span class="item-count">{{ family.totalCount }}</span>

            <div class="expand-chevron" (click)="toggleExpanded(family, $event)">
              <i
                class="fa fa-chevron-down"
                [style.transform]="family.expanded ? 'rotate(180deg)' : ''"
              ></i>
            </div>
          </div>
        </div>

        <!-- Sub-Category Drawer -->
        <div class="curator-drawer" *ngIf="family.expanded">
          <div class="drawer-inner customs-scroll">
            <div
              *ngFor="let child of family.children"
              class="sub-row"
              (click)="toggleSubCategory(child, family)"
            >
              <div class="sub-dot" [class.active]="!child.hidden"></div>
              <span class="sub-label" [class.archived]="child.hidden">{{ child.name }}</span>
              <div class="sub-action-icon">
                <i
                  class="fa"
                  [class.fa-eye]="!child.hidden"
                  [class.fa-eye-slash]="child.hidden"
                ></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal-footer category-manager-footer py-2">
  <div class="w-100 text-center">
    <small class="text-muted">
      <strong>Card:</strong> Toggle Visibility. <strong>Checkbox:</strong> Multi-select.
      <strong>Chevron:</strong> View Details.
    </small>
  </div>
</div>
